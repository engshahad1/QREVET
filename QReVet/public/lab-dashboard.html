<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù„ÙˆØ­Ø© ÙÙ†ÙŠ Ø§Ù„Ù…Ø®ØªØ¨Ø± - QReVet</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Cairo', sans-serif; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen p-6">
  <h1 class="text-3xl font-bold text-center mb-6 text-orange-600">Ù„ÙˆØ­Ø© ÙÙ†ÙŠ Ø§Ù„Ù…Ø®ØªØ¨Ø±</h1>

  <div id="animalList" class="grid grid-cols-1 gap-4 max-w-4xl mx-auto">
    <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø³ØªÙØ¶Ø§Ù Ù‡Ù†Ø§ -->
  </div>

  <script>
    async function fetchAnimals() {
      const res = await fetch('/api/animals');
      const data = await res.json();
      const list = document.getElementById("animalList");
      list.innerHTML = "";

      data.data.forEach(animal => {
        if (animal.status === "Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡") {
          const card = document.createElement("div");
          card.className = "bg-white rounded-xl shadow-md p-4 space-y-2 border border-gray-200";

          card.innerHTML = `
            <p><strong>ğŸ¾ Ø§Ø³Ù… Ø§Ù„Ø­ÙŠÙˆØ§Ù†:</strong> ${animal.name}</p>
            <p><strong>ğŸª Ù†ÙˆØ¹ Ø§Ù„Ø­ÙŠÙˆØ§Ù†:</strong> ${animal.type}</p>
            <p><strong>ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ:</strong> ${animal.owner}</p>
            <p><strong>ğŸ”¢ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ:</strong> ${animal.id}</p>

            <label class="block text-sm font-medium mt-2">Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙØ­Øµ:</label>
            <input type="text" id="result-${animal.id}" class="w-full border p-2 rounded" placeholder="Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙØ­Øµ" />

            <label class="block text-sm font-medium mt-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
            <textarea id="notes-${animal.id}" class="w-full border p-2 rounded" rows="2" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª ..."></textarea>

            <button id="save-btn-${animal.id}" onclick="submitResult(${animal.id})"
              class="mt-3 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
              Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø©
            </button>
          `;

          list.appendChild(card);
        }
      });
    }

    async function submitResult(id) {
      const resultInput = document.getElementById(`result-${id}`);
      const notesInput = document.getElementById(`notes-${id}`);
      const btn = document.getElementById(`save-btn-${id}`);

      const result = resultInput.value.trim();
      const notes = notesInput.value.trim();

      if (!result) {
        alert("âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙØ­Øµ Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸.");
        return;
      }

      btn.disabled = true;
      btn.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";

      const res = await fetch(`/api/animals/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ result, notes })
      });

      const data = await res.json();
      if (data.success) {
        alert("âœ… ØªÙ… Ø­ÙØ¸ Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙØ­Øµ Ø¨Ù†Ø¬Ø§Ø­!");
        fetchAnimals(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸
      } else {
        alert("âŒ ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
        btn.disabled = false;
        btn.textContent = "Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø©";
      }
    }

    fetchAnimals();
  </script>
</body>
</html>
